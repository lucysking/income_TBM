{
    "collab_server" : "",
    "contents" : "---\ntitle: \"Deprivation and Threat\"\nauthor: \"Lucy King\"\noutput: html_notebook\n---\n\nThis script is to generate measures of deprivation and threat using the definitions provided by Sheridan & McLaughlin (2014):\n\n\"\nThreat\nExperiences of threat involve the presence of an atypical (i.e., unexpected) experience characterized by actual or threatened death, injury, sexual violation, or other harm to oneâ€™s physical integrity. Our definition of threat is consistent with the definition of a traumatic event in the Diagnostic and Statistical Manual of Mental Disorders \n\nDeprivation\nExperiences of deprivation involve the absence of expected environmental inputs in cognitive (e.g., language) and social domains as well as the absence of species- and age-typical complexity in environmental stimulation.\n\"\n\nIn the ELS study, the semi-structered \"ELS Interview\" is a modified version of the TESI-C. The majority of the items on this interview could be viewed as \"threat.\" However, some items more clearly align with the definition of Sheridan & McLaughlin (e.g., domestic violence) while others are less clear (e.g., witnessing an accident) because of variation in the severity of experiences reported in certain categories. Therefore, we decided to be conservative and include items that are clearly threatening because they involve interpersonal harmful input to either child, someone close to the child, or the child's community.\n\nDeprivation can be measured in a number of ways. In the ELS study, we have two measures of deprivation: income to needs and the Multidimensional Neglectful Behavior Scale (MNBS). \n\n```{r load packages}\nlibrary(foreign)\nlibrary(stats)\nlibrary(dplyr)\nlibrary(ggplot2)\nlibrary(corrplot)\nlibrary(moments)\n```\n\n```{r calculate severity of threat}\n#deleted 172.2 from spss file\nthreat <- read.spss(\"~/Desktop/ELS/dep_thrt_TBM/data/Best_ELS T1 Integrated Stress Interview_Panel Ratings_Copy 1_reformat_wStressVariables_020117.sav\", to.data.frame = T)\n\nthreat <- threat %>%\n  select(\n    ELS_ID,\n    PhysAb,\n    ThrtPhysAb,\n    Bully,\n    Kidnap,\n    ParArg,\n    DomThrt,\n    DomViol,\n    CommArg,\n    CommPhys,\n    WarTerr,\n    SexAb,\n    Wit_SexAb,\n    EmoAb,\n    CommInst,\n    Mugging,\n    MaxSev_PhysAb,\n    MaxSev_ThrtPhysAb,\n    MaxSev_Bully,\n    MaxSev_Kidnap,\n    MaxSev_ParArg,\n    MaxSev_DomThrt,\n    MaxSev_DomViol,\n    MaxSev_CommArg,\n    MaxSev_CommPhys,\n    MaxSev_WarTerr,\n    MaxSev_SexAb,\n    MaxSev_Wit_SexAb,\n    MaxSev_EmoAb,\n    MaxSev_CommInst,\n    MaxSev_Mugging\n  )\n\nthreat$sumsev_type_THRT <- rowSums(subset(threat, select = c(MaxSev_PhysAb, MaxSev_ThrtPhysAb, MaxSev_Bully, MaxSev_Kidnap, MaxSev_ParArg, MaxSev_DomThrt, MaxSev_DomViol, \nMaxSev_CommArg, MaxSev_CommPhys, MaxSev_WarTerr, MaxSev_SexAb, MaxSev_Wit_SexAb, MaxSev_EmoAb, MaxSev_CommInst, MaxSev_Mugging)))\n\nggplot(threat, aes(x = sumsev_type_THRT)) + \n  geom_histogram(bins = 30, position = \"dodge\", fill= \"gray\", color = \"black\")+\n  theme_bw() \n\nthreat$max_sev_THRT <- apply(threat[, 17:31], 1, max) \n\nggplot(threat, aes(x = max_sev_THRT)) + \n  geom_histogram(bins = 30, position = \"dodge\", fill= \"gray\", color = \"black\")+\n  theme_bw() \n\nthreat$num_type_THRT <- rowSums(subset(threat, select = c(PhysAb, ThrtPhysAb, Bully, Kidnap, ParArg, DomThrt, DomViol, CommArg, CommPhys, WarTerr, SexAb, Wit_SexAb, EmoAb, CommInst, Mugging)))\n\nggplot(threat, aes(x = num_type_THRT)) + \n  geom_histogram(bins = 30, position = \"dodge\", fill= \"gray\", color = \"black\")+\n  theme_bw() \n\n```\n\n```{r calculate income to needs}\n#in SPSS file, first cleaned variable \"pplinhome_1_TEXT\" and converted to numeric \ndep <- read.spss(\"~/Desktop/ELS/dep_thrt_TBM/data/120616_ELS_T1S1_Demographics Golden Standard.sav\", to.data.frame = T)\ndep[dep == 999] <- NA\n\n#income reported in bins, used median for income to needs as in Yu et al. (2017) developmental science\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 1, 5000, NA)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 2, 7500, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 3, 12500, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 4, 20000, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 5, 30000, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 6, 42500, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 7, 62500, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 8, 87500, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 9, 125000, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 10, 150000, dep$Household_Income_Num)\ndep$Household_Income_Num <- ifelse(dep$Household_Income == 11, NA, dep$Household_Income_Num)\n\n\n#santa clara country income : low income (threshold for low income is set at 1.6x the relevant 4 person very low income level; very low income level is 50% of the median income for santa clara county with adjustment for high cost of housing; ratios <= 1 are therefore \"low income\")\n#https://www.huduser.gov/portal/datasets/il/il2017/2017summary.odn\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 1, 59350, NA)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 2, 67800, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 3, 76300, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 4, 84750, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 5, 91500, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 6, 98350, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 7, 105100, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT == 8, 111900, dep$SC_lowincome)\ndep$SC_lowincome <- ifelse(dep$pplinhome_1_TEXT > 8, 111900, dep$SC_lowincome)\n\ndep$income_needs <- dep$Household_Income_Num/dep$SC_lowincome\n\nggplot(dep, aes(x = income_needs)) + \n  geom_histogram(bins = 30, position = \"dodge\", fill= \"gray\", color = \"black\")+\n  theme_bw() \n```\n\n```{r merge}\ndep_thrt <- merge(x = threat, y = dep[, c(\"income_needs\", \"ELS_ID\")], by = \"ELS_ID\", all = T)\ncor.test(dep_thrt$sumsev_type_THRT, dep_thrt$income_needs)\n\npng(filename=\"~/Desktop/ELS/dep_thrt_TBM/depthrt_sync/plots/income_threat.png\", width = 600, height = 500)\nggplot(data=dep_thrt, aes(x=income_needs, y=sumsev_type_THRT)) +\n  geom_point(size = 2) +\n  geom_smooth(method = \"lm\", se = F, color = \"orange\", size =2) +\n  theme_bw()+theme(legend.position = \"none\", panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.title.y = element_text(size = 20), axis.title.x = element_text(size = 20), axis.text.x = element_text(size = 18), axis.text.y = element_text(size = 18)) +\n  ylab(\"Threatening Stress\") +\n  xlab(\"Income-to-Needs\")\n```\n\n```{r calculate neglect}\n#first removed \"values\" in SPSS file so that R would read scores as numeric; removed scores from 187 (all 4s, did not follow instructions)\n#neg1 <- read.spss(\"/Volumes/mooddata/LucyKing/Dep_Thrt_TBM/ELS_T1S1_Child_MNBS.sav\", to.data.frame = T)\n#neg1[neg1 == 999] <- NA\n#neg1[neg1 == 888] <- NA\n\n#neg1$mnbs_tot_T1 <- rowMeans(subset(neg1, select = c(T1_MNBS_C_1, T1_MNBS_C_2, T1_MNBS_C_3, T1_MNBS_C_4, T1_MNBS_C_5, T1_MNBS_C_6, T1_MNBS_C_7, T1_MNBS_C_8)), na.rm = T)\n#neg1$mnbs_tot_T1 <- neg1$mnbs_tot_T1*8\n\n#first removed IDs with .5 or .2 to keep only earliest MNBS assessments\n#neg2 <- read.spss(\"/Volumes/mooddata/LucyKing/Dep_Thrt_TBM/ELS_T2S1_CDI_PDS_Tanner_ARIC_MNBS_HQY_SIQJR- Copy1.sav\", to.data.frame = T)\n#neg2[neg2 == 999] <- NA\n#neg2[neg2 == 888] <- NA\n\n#neg2$mnbs_tot_T2 <- rowMeans(subset(neg2, select = c(T2_MNBS_C_1, T2_MNBS_C_2, T2_MNBS_C_3, T2_MNBS_C_4, T2_MNBS_C_5, T2_MNBS_C_6, T2_MNBS_C_7, T2_MNBS_C_8)), na.rm = T)\n#neg2$mnbs_tot_T2 <- neg2$mnbs_tot_T2*8\n\n#neg <- merge(neg1[, c(\"mnbs_tot_T1\", \"ELS_ID\")], neg2[, c(\"mnbs_tot_T2\", \"ELS_ID\")], by = \"ELS_ID\", all.x = T)\n\n#neg$mnbs_tot <- ifelse(is.na(neg$mnbs_tot_T1), neg$mnbs_tot_T2, neg$mnbs_tot_T1)\n```\n\n```{r merge again}\n#dep_thrt <- merge(x = dep_thrt, neg[, c(\"mnbs_tot\", \"ELS_ID\")], by = \"ELS_ID\", all = T)\n\ncorr_dt <- dep_thrt[,32:35]\ncorr_dt <- cor(corr_dt, use = \"pairwise.complete.obs\")\ncorrplot <- corrplot(corr_dt, order = \"hclust\", tl.col='black', tl.cex=.75)\n\n#cor.test(dep_thrt$income_needs, dep_thrt$mnbs_tot)\n#cor.test(dep_thrt$sumsev_type_THRT, dep_thrt$mnbs_tot)\n#cor.test(dep_thrt$max_sev_THRT, dep_thrt$mnbs_tot)\n#cor.test(dep_thrt$num_type_THRT, dep_thrt$mnbs_tot)\ncor.test(dep_thrt$num_type_THRT, dep_thrt$max_sev_THRT)\ncor.test(dep_thrt$num_type_THRT, dep_thrt$sumsev_type_THRT)\ncor.test(dep_thrt$max_sev_THRT, dep_thrt$sumsev_type_THRT)\n\n#write.csv(dep_thrt,\"/Volumes/mooddata/LucyKing/Dep_Thrt_TBM/dep_thrt_113017.csv\")\n```\n\n```{r transform income:needs}\ndep_thrt$income_needs_sqrt <- sqrt(dep_thrt$income_needs)\nwrite.csv(dep_thrt, \"~/Desktop/ELS/dep_thrt_TBM/income_threat.csv\")\n```\n\n\n",
    "created" : 1521674476168.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3541523907",
    "id" : "B981A67A",
    "lastKnownWriteTime" : 1522090165,
    "last_content_update" : 1522090165414,
    "path" : "~/Desktop/ELS/dep_thrt_TBM/depthrt_sync/depthrt_scripts/threat_deprivation.Rmd",
    "project_path" : "threat_deprivation.Rmd",
    "properties" : {
        "chunk_output_type" : "inline"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}